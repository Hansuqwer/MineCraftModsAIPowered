<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Black Dragon Preview - FIXED</title>
    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
    <style>
        html,
        body {
            margin: 0;
            overflow: hidden;
            background: #161616;
        }

        #renderCanvas {
            width: 100vw;
            height: 100vh;
            touch-action: none;
            display: block;
        }

        #hud {
            position: fixed;
            left: 8px;
            bottom: 8px;
            right: 8px;
            color: #eee;
            font: 12px/1.4 system-ui, sans-serif;
            pointer-events: none;
            max-height: 200px;
            overflow-y: auto;
        }

        .err {
            color: #ff6b6b;
        }

        .success {
            color: #4ade80;
        }

        .warning {
            color: #fbbf24;
        }
    </style>
</head>

<body>
    <canvas id="renderCanvas"></canvas>
    <div id="hud"></div>
    <script>
        (async function () {
            const log = (msg, cls = "") => {
                const el = document.getElementById('hud');
                el.innerHTML += `<div class="${cls}">${msg}</div>`;
                console.log(`[HUD] ${msg}`);
            };

            // Enhanced error catching
            window.addEventListener('error', e => {
                log(`JS Error: ${e.message} at ${e.filename}:${e.lineno}`, 'err');
            });
            window.addEventListener('unhandledrejection', e => {
                log(`Promise Error: ${e.reason}`, 'err');
            });

            const canvas = document.getElementById("renderCanvas");
            const engine = new BABYLON.Engine(canvas, true, { preserveDrawingBuffer: true, stencil: true });
            const scene = new BABYLON.Scene(engine);

            const camera = new BABYLON.ArcRotateCamera("cam",
                Math.PI / 4, Math.PI / 3, 7, BABYLON.Vector3.Zero(), scene);
            camera.wheelPrecision = 50;
            camera.panningSensibility = 0;
            camera.attachControl(canvas, true);

            // Enhanced lighting for better visibility
            const hemi = new BABYLON.HemisphericLight("hemi", new BABYLON.Vector3(0.5, 1, 0.2), scene);
            hemi.intensity = 1.2; // Brighter ambient light

            const dir = new BABYLON.DirectionalLight("dir", new BABYLON.Vector3(-1, -2, -1), scene);
            dir.position = new BABYLON.Vector3(5, 10, 5);
            dir.intensity = 0.8; // Stronger directional light

            // Additional point light for better visibility
            const pointLight = new BABYLON.PointLight("point", new BABYLON.Vector3(0, 5, 0), scene);
            pointLight.intensity = 0.6;

            log("ðŸŽ¨ Creating detailed dragon model...");

            // Create a detailed dragon model procedurally since GLB loading fails
            function createDetailedDragon(scene) {
                log("ðŸ‰ Building dragon components...");

                // Main body (larger, more dragon-like)
                const body = BABYLON.MeshBuilder.CreateBox("body", {
                    width: 2.5, height: 2.5, depth: 4
                }, scene);
                body.position.y = 1.2;

                // Dragon head (more detailed with snout)
                const head = BABYLON.MeshBuilder.CreateBox("head", {
                    width: 2, height: 2, depth: 2
                }, scene);
                head.position.y = 2.5;
                head.position.z = -2;

                // Dragon snout (extended nose)
                const snout = BABYLON.MeshBuilder.CreateBox("snout", {
                    width: 1, height: 0.8, depth: 1.2
                }, scene);
                snout.position.y = 2.5;
                snout.position.z = -2.8;

                // Dragon horns (small pointed horns on head)
                const leftHorn = BABYLON.MeshBuilder.CreateBox("leftHorn", {
                    width: 0.2, height: 0.4, depth: 0.2
                }, scene);
                leftHorn.position.x = -0.4;
                leftHorn.position.y = 2.6;
                leftHorn.position.z = -1.2;

                const rightHorn = BABYLON.MeshBuilder.CreateBox("rightHorn", {
                    width: 0.2, height: 0.4, depth: 0.2
                }, scene);
                rightHorn.position.x = 0.4;
                rightHorn.position.y = 2.6;
                rightHorn.position.z = -1.2;

                // Dragon wings (larger, more imposing)
                const leftWing = BABYLON.MeshBuilder.CreateBox("leftWing", {
                    width: 4, height: 0.3, depth: 3
                }, scene);
                leftWing.position.x = -2;
                leftWing.position.y = 2.5;
                leftWing.position.z = 0;

                const rightWing = BABYLON.MeshBuilder.CreateBox("rightWing", {
                    width: 4, height: 0.3, depth: 3
                }, scene);
                rightWing.position.x = 2;
                rightWing.position.y = 2.5;
                rightWing.position.z = 0;

                // Dragon tail (segmented, longer)
                const tail1 = BABYLON.MeshBuilder.CreateBox("tail1", {
                    width: 1, height: 1, depth: 1.5
                }, scene);
                tail1.position.y = 1.5;
                tail1.position.z = 2.5;

                const tail2 = BABYLON.MeshBuilder.CreateBox("tail2", {
                    width: 0.8, height: 0.8, depth: 1.2
                }, scene);
                tail2.position.y = 1.3;
                tail2.position.z = 3.8;

                const tail3 = BABYLON.MeshBuilder.CreateBox("tail3", {
                    width: 0.6, height: 0.6, depth: 1
                }, scene);
                tail3.position.y = 1.1;
                tail3.position.z = 4.8;

                // Dragon legs (four legs for stability)
                const leg1 = BABYLON.MeshBuilder.CreateBox("leg1", {
                    width: 0.5, height: 1.5, depth: 0.5
                }, scene);
                leg1.position.x = -0.7;
                leg1.position.y = 0.25;
                leg1.position.z = -1;

                const leg2 = BABYLON.MeshBuilder.CreateBox("leg2", {
                    width: 0.5, height: 1.5, depth: 0.5
                }, scene);
                leg2.position.x = 0.7;
                leg2.position.y = 0.25;
                leg2.position.z = -1;

                const leg3 = BABYLON.MeshBuilder.CreateBox("leg3", {
                    width: 0.5, height: 1.5, depth: 0.5
                }, scene);
                leg3.position.x = -0.7;
                leg3.position.y = 0.25;
                leg3.position.z = 1;

                const leg4 = BABYLON.MeshBuilder.CreateBox("leg4", {
                    width: 0.5, height: 1.5, depth: 0.5
                }, scene);
                leg4.position.x = 0.7;
                leg4.position.y = 0.25;
                leg4.position.z = 1;

                // Glowing red eyes (smaller, more intense)
                const leftEye = BABYLON.MeshBuilder.CreateBox("leftEye", {
                    width: 0.15, height: 0.15, depth: 0.15
                }, scene);
                leftEye.position.x = -0.3;
                leftEye.position.y = 2.2;
                leftEye.position.z = -2.2;

                const rightEye = BABYLON.MeshBuilder.CreateBox("rightEye", {
                    width: 0.15, height: 0.15, depth: 0.15
                }, scene);
                rightEye.position.x = 0.3;
                rightEye.position.y = 2.2;
                rightEye.position.z = -2.2;

                // Dragon material (red dragon with better visibility)
                const dragonMat = new BABYLON.StandardMaterial("dragonMat", scene);
                dragonMat.diffuseColor = new BABYLON.Color3(0.8, 0.2, 0.2); // Bright red
                dragonMat.specularColor = new BABYLON.Color3(0.8, 0.8, 0.8);
                dragonMat.emissiveColor = new BABYLON.Color3(0.1, 0.05, 0.05); // Slight red glow
                dragonMat.metallicFactor = 0.1;
                dragonMat.roughnessFactor = 0.3;

                // Green scale material for accents
                const scaleMat = new BABYLON.StandardMaterial("scaleMat", scene);
                scaleMat.diffuseColor = new BABYLON.Color3(0, 0.8, 0); // Bright green
                scaleMat.specularColor = new BABYLON.Color3(0.2, 0.8, 0.2);
                scaleMat.metallicFactor = 0.4;
                scaleMat.roughnessFactor = 0.6;

                // Eye material (intensely glowing red)
                const eyeMat = new BABYLON.StandardMaterial("eyeMat", scene);
                eyeMat.diffuseColor = new BABYLON.Color3(1, 0, 0);
                eyeMat.emissiveColor = new BABYLON.Color3(1, 0, 0); // Very bright red glow

                // Apply materials
                body.material = dragonMat;
                head.material = dragonMat;
                snout.material = dragonMat;
                leftHorn.material = dragonMat;
                rightHorn.material = dragonMat;
                leftWing.material = dragonMat;
                rightWing.material = dragonMat;
                tail1.material = dragonMat;
                tail2.material = scaleMat; // Green scales on tail
                tail3.material = scaleMat; // Green scales on tail tip
                leg1.material = dragonMat;
                leg2.material = dragonMat;
                leg3.material = dragonMat;
                leg4.material = dragonMat;
                leftEye.material = eyeMat;
                rightEye.material = eyeMat;

                // Merge all parts into one dragon
                const dragon = BABYLON.Mesh.MergeMeshes([
                    body, head, snout, leftHorn, rightHorn,
                    leftWing, rightWing, tail1, tail2, tail3,
                    leg1, leg2, leg3, leg4, leftEye, rightEye
                ], true, true);
                dragon.name = "dragon";

                // Add rotation animation
                scene.registerBeforeRender(() => {
                    dragon.rotation.y += 0.01;
                });

                log("âœ… Detailed dragon created successfully!", 'success');
                return dragon;
            }

            // Create the detailed dragon
            const dragon = createDetailedDragon(scene);

            engine.runRenderLoop(() => scene.render());
            window.addEventListener("resize", () => engine.resize());

            log("ðŸŽ¬ Render loop started");
        })();
    </script>
</body>

</html>